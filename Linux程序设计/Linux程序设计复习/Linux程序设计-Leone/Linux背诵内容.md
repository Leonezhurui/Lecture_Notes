# Linux背诵内容

1. Linux系统的概念

根据GNU通用公共许可证开发的免费Unix类型的操作系统。

* 开源
* 受欢迎的
* 支持大多数可用平台



2. Linux启动流程

BIOS-》BootLoader-〉kernel-》init

BIOS：基本输入输出系统，检查内存和硬件，从非易失性存储器中加载选项，检查启动设备，加载启动设备的MBR并执行。

BootLoader：引导加载程序加载并启动Linux内核(LILO,GRUB)



3. CLI vs GUI

CLI:

1. 学习起来困难，对初学者不友善
2. 代码运行效率高
3. 单一颜色界面或无界面
4. 只需要键盘就可以操作，不支持触屏
5. 运行效率高，稳定性好
6. 适合用于管理服务器

GUI：

1. 学习起来简单，对初学者友善
2. 代码运行效率中等
3. 丰富的界面颜色，
4. 键盘、鼠标，支持触屏等功能
5. 界面大小和硬件配置



4. 安装应用程序的一般步骤

from a tarball

```shell
tar zxvf application.tar.gz
cd application
./config
make
su
make install
```

Apt-get

Apt-get工作原理：

1. 检查源列表`/etc/apt/sources.list`
2. 查询`Packages.gz`获取所有包
3. 下载包和依赖：递归下载依赖



5. 根目录结构(各个目录的作用)

1. /home：用户家目录
2. /root：系统管理员的家目录
3. /bin：二进制可执行文件
4. /sbin：系统二进制可执行文件，主要用于系统管理员维护系统。
5. /lib：系统库，存放着支持/bin和/sbin的库文件
6. /usr：包含二进制文件、库文件、文档、二级程序的源代码
7. /dev：存放着所有的设备文件
8. /etc：存放着所有的配置文件
9. /var：变量文件，包含内容可能增长的文件，例如日志文件、数据库文件
10. /tmp：临时目录，重启系统时，这个目录下的所有文件将被删除。
11. /proc：存放着系统进程相关文件
12. /mnt：挂载目录
13. /boot：包含引导加载程序相关文件



6. 进程的概念

进程是一个正在执行的程序实例，它由执行程序，当前的值，状态信息以及通过操作系统管理此进程执行的资源组成。



第二章

1. 各种类型的shell

bash、sh、csh、tcsh、ash、ash.static、bsh



第四章

1. gcc选项

-E：预处理

-S：预处理+编译--汇编代码

-c：编译但不链接，生成.o文件

-o output_file：生成目标文件



如何生成库文件

ar命令生成静态库文件：

```shell
gcc -c h.c -o h.o
ar rcs libh.a h.o 
```

gcc命令生成动态库文件

```shell
gcc -shared -fPCI -o libmyhello.so hello.c
```

动态库和静态库区别

静态（函数）库
一般扩展名为（.a或.lib）
这类库在编译的时候会直接整合到目标程序中，所以利用静态函数库编译成的文件会比较大。

这类函数库最大的优点就是编译成功的可执行文件可以独立运行，而不再需要连接库文件；但是从升级难易度来看明显没有优势，如果函数库更新，需要重新编译。

动态函数库
动态函数库的扩展名一般为（.so或.dll）
动态函数库在编译的时候，在程序里只有一个“指向”的位置而已，也就是说当可执行文件需要使用到函数库的机制时，程序才会去读取函数库来使用；也就是说可执行文件无法单独运行。

这样从产品功能升级角度方便升级，只要替换对应动态库即可，不必重新编译整个可执行文件。




2. gdb 命令
   1. 设置断点(break/tbreak)
   2. 监视变量值(display/print)
   3. 单步执行(next/step)
   4. 修改变量值(print)



3. make和makefile的功能
   1. makefile描述模块间的依赖关系；
   2. make命令根据makefile对文件进行管理和维护；make可以判断被维护文件之间的时序关系。



4. makefile的执行次序
   1. make命令会寻找目录下的Makefile或makefile文件。
   2. 在makefile中寻找到target文件或伪目标。
   3. 判断目标是否存在或时序关系是否符合；然后根据依赖关系递归执行命令。





第五章



1. 文件和文件系统的概念

文件：具有读取或写入或兼有的对象，它具有某些属性，包括访问权限和类型。

文件系统：文件及其某些属性的集合，它为引用这些文件的文件序列号提供了名称空间。

2. 七种文件类型和字母简写

regular file

directory

character special file

block special file

fifo

symbolic file

socket file



3. VFS基本原理和model(4个组成部分)

VFS：虚拟文件系统转换，是一个内核软件层，是具体文件系统之上的一层抽象。能够为不同的文件系统提供统一的对外接口，使得上层应用能够使用通用的接口访问不同的文件系统。

superblock超级块：存储文件系统基本的元数据，包括文件系统的类型、大小、状态等等。

inode：保存一个文件的元数据，包括文件所有者、最后访问时间、文件类型等等。

dentry：保存着文件名称和具体inode之间的对应关系，同时实现目录和其包含的文件的映射关系。

file：对象对象是一个具体文件被打开之后所创建的内存数据结构。



4. 系统调用 vs C库函数：
   1. 都是以C函数的形式出现。
   2. 系统调用是Linux内核对外的接口；是用户程序和内核之间唯一的接口；提供了最小的接口。
   3. C库函数依赖系统调用，提供复杂功能，例如I/O标准函数。



5. 文件锁的分类(fcntl函数上锁的使用)

记录锁、劝告锁、强制锁、共享锁、排他锁。

```C
int fcntl(int fd, int cmd, struct flock* lock);
```

cmd：F_SETLK、F_SETLKW、F_GETLK

flock结构体中的l_type：F_RDLCK, F_WRLCK, F_UNLCK



第六章

1. Linux内核的概念

什么是内核？操作系统是由一系列程序组成的，其中最重要的部分就是内核。

单内核/微内核：单内核是一个很大的进程，内部有多个模块，作为了一个独立的二进制文件运行，进程间通信通过函数调用的方式进行。微内核的大部分内核程序作为独立的进程运行，通过消息传递进行通信。

Linux区别于其他商业版内核的特点：单内核，模块支持；免费/开源；支持多种CPU，硬件支持能力非常强大；Linux开发者都有优秀的程序员；学习Linux内核源码就可以了解现代操作系统的基本原理。



2. 用户程序和内核程序区别

|          | C语言程序 | Linux内核程序 |
| -------- | --------- | ------------- |
| 运行空间 | 用户空间  | 内核空间      |
| 入口     | main()    | module_init() |
| 出口     | 无        | module_exit() |
| 运行     | 直接运行  | Ins mod       |
| 调试     | gdb       | kdb, kdbug    |

内核程序编写注意点：

1. 不能使用C库函数编写
2. 没有内存保护机制
3. 小内核栈
4. 并发上的考虑(支持高并发)



3. 字符设备驱动程序的初始化加载过程
   1. 